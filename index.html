<!DOCTYPE html>
<html lang="tr" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>TKGM Mevzuat Sistemi</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='15' fill='%234f46e5'/%3E%3Cpath d='M25 75 L25 25 L75 25 L75 75 Z M25 50 L75 50 M50 25 L50 75' stroke='%23ffffff' stroke-width='6' fill='none' stroke-linecap='round'/%3E%3C/svg%3E" type="image/svg+xml">

    <!-- Tailwind CSS for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- PDF.js for rendering PDFs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js"></script>
    
    <!-- Three.js for animated background -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #1f2937; } /* bg-gray-800 */
        ::-webkit-scrollbar-thumb { background: #4f46e5; border-radius: 10px; } /* bg-indigo-600 */
        ::-webkit-scrollbar-thumb:hover { background: #6366f1; } /* bg-indigo-500 */
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* bg-gray-900 */
            overflow-y: auto; /* Allow vertical scrolling for the whole page */
        }

        #dynamic-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        .content-wrapper {
            position: relative;
            z-index: 1;
        }
        
        /* Modal Base Styles */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.7); backdrop-filter: blur(5px);
            display: none; justify-content: center; align-items: center;
            z-index: 1000; animation: fadeIn 0.3s;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .modal.active { display: flex; }
        .modal-content {
            background-color: #1f2937; /* bg-gray-800 */
            width: 95%; height: 95%;
            border-radius: 0.75rem; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            display: flex; flex-direction: column; overflow: hidden;
            border: 1px solid #374151; /* border-gray-700 */
        }
        .modal-header {
            display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center;
            padding: 1rem;
            border-bottom: 1px solid #374151; /* border-gray-700 */
            flex-shrink: 0;
            transition: all 0.3s ease-in-out;
        }
        
        /* Modal Specifics */
        #selection-modal-content, #favorites-modal-content { 
            max-width: 800px; 
            max-height: 90%; 
            background-color: rgba(17, 24, 39, 0.6); /* bg-gray-900 with more transparency */
            backdrop-filter: blur(10px);
        }
        #selection-modal-body, #favorites-modal-body { padding: 1rem; md:padding: 2rem; overflow-y: auto; }

        /* PDF Modal Specifics */
        #pdf-modal { z-index: 1100; /* Ensure PDF modal is above other modals */ }
        #pdf-modal-content { 
            max-width: 95vw;
            height: 98%;
            transition: all 0.4s cubic-bezier(0.25, 1, 0.5, 1);
        }
        #pdf-modal.fullscreen-active #pdf-modal-content {
            width: 100vw;
            height: 100vh;
            max-width: 100%;
            border-radius: 0;
            background-color: #111827; /* Match body bg for seamless feel */
        }
        #pdf-modal.fullscreen-active .modal-header,
        #pdf-modal.fullscreen-active #pdf-modal-footer {
            opacity: 0;
            pointer-events: none;
            height: 0;
            padding: 0;
            border: none;
            overflow: hidden;
        }
        #pdf-modal-footer {
            transition: all 0.3s ease-in-out;
        }
        #pdf-render-area { 
            flex-grow: 1; 
            overflow: auto;
            padding: 1rem; 
            touch-action: none;
        }
        #pdf-pages-container {
            position: relative;
            width: fit-content;
            margin: auto;
        }
        .page-container {
            position: relative;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            background-color: #374151;
            margin-bottom: 1rem;
        }
        .page-container:last-child {
            margin-bottom: 0;
        }
        .page-container canvas { display: block; }
        .text-layer { position: absolute; top: 0; left: 0; line-height: 1.0; pointer-events: auto; }
        .text-layer > span, .text-layer > br { position: absolute; color: transparent; white-space: pre; transform-origin: 0% 0%; }
        
        /* Loading spinner styles */
        .loader { border: 4px solid #374151; border-top: 4px solid #6366f1; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        #main-loader-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(17, 24, 39, 0.8); display: flex; justify-content: center; align-items: center; z-index: 9999; flex-direction: column; gap: 1rem; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Search & Favorites Styles */
        .highlight { background-color: rgba(255, 255, 0, 0.4); }
        .current-highlight { background-color: rgba(255, 165, 0, 0.6); }
        .favorite-btn.favorited svg { fill: #facc15; color: #facc15; } /* yellow-400 */
        
        /* Voice Search Pulse Animation */
        @keyframes pulse-red { 0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); } 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); } }
        .voice-active { animation: pulse-red 1.5s infinite; color: #ef4444 !important; }

        /* Pill Info Card Animation */
        @keyframes glow-border { 0% { border-color: rgba(139, 92, 246, 0.5); } 50% { border-color: rgba(139, 92, 246, 1); } 100% { border-color: rgba(139, 92, 246, 0.5); } }
        .pill-card { animation: glow-border 3s infinite; }

        /* Toast Notification */
        #toast {
            position: fixed;
            bottom: -100px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #4f46e5; /* indigo-600 */
            color: white;
            padding: 1rem 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: bottom 0.5s ease-in-out;
            z-index: 10000;
        }
        #toast.show {
            bottom: 30px;
        }

        /* Share Modal */
        #share-modal-content {
            width: auto;
            height: auto;
            padding: 1.5rem;
        }
    </style>
</head>
<body class="h-full text-gray-200">
    <canvas id="dynamic-bg"></canvas>

    <div id="main-loader-container">
        <div class="loader"></div>
        <p class="text-white font-bold text-lg">Mevzuat verileri yükleniyor...</p>
    </div>

    <div id="app-container" class="content-wrapper h-full flex flex-col" style="display: none;">
        <div class="absolute top-4 right-4 z-10">
            <button id="favorites-main-btn" class="p-3 rounded-full bg-gray-800/50 hover:bg-gray-700/70 transition text-yellow-400" title="Favoriler">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="1"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"></path></svg>
            </button>
        </div>

        <main id="home-page" class="page active p-4 sm:p-6 lg:p-8 flex-grow flex flex-col">
            <div class="pt-8">
                <header class="text-center mb-8">
                    <h1 class="text-4xl sm:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-indigo-500">
                        TKGM Mevzuat Sistemi
                    </h1>
                    <p class="text-gray-400 mt-2">© Gökhan ELGÜL tarafından tasarlanmıştır.</p>
                </header>
                <div class="mb-8 max-w-2xl w-full mx-auto">
                    <div class="relative flex items-center">
                        <span class="absolute left-4 text-gray-500"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg></span>
                        <input type="text" id="search-input" placeholder="Mevzuat içinde ara..." class="w-full bg-gray-800/80 border border-gray-700 rounded-full py-3 pl-12 pr-20 text-gray-200 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition shadow-sm">
                        <div class="absolute right-3 flex items-center gap-2">
                             <button id="voice-search-btn" class="text-gray-400 hover:text-white transition p-2 rounded-full" title="Sesli Arama">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></svg>
                            </button>
                            <button id="clear-search-btn" class="text-gray-500 hover:text-white transition hidden p-1">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="flex-grow flex flex-col justify-center gap-8">
                <div id="search-results" class="max-w-4xl w-full mx-auto overflow-y-auto"></div>
                
                <div id="main-categories" class="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-6xl mx-auto w-full">
                    <div data-section="tapu" class="bg-gray-800/50 backdrop-blur-sm rounded-xl p-6 shadow-lg hover:shadow-cyan-500/20 hover:-translate-y-2 transition-all duration-300 cursor-pointer flex flex-col items-center justify-center text-center border border-gray-700">
                        <h2 class="text-2xl font-bold text-yellow-400 mb-2">TAPU</h2>
                        <p class="text-gray-400">Tapu Dairesi Başkanlığı ile ilgili belgeler.</p>
                    </div>
                    <div data-section="kadastro" class="bg-gray-800/50 backdrop-blur-sm rounded-xl p-6 shadow-lg hover:shadow-cyan-500/20 hover:-translate-y-2 transition-all duration-300 cursor-pointer flex flex-col items-center justify-center text-center border border-gray-700">
                        <h2 class="text-2xl font-bold text-blue-400 mb-2">KADASTRO</h2>
                        <p class="text-gray-400">Kadastro Dairesi Başkanlığı ile ilgili belgeler.</p>
                    </div>
                    <div data-section="genel" class="bg-gray-800/50 backdrop-blur-sm rounded-xl p-6 shadow-lg hover:shadow-cyan-500/20 hover:-translate-y-2 transition-all duration-300 cursor-pointer flex flex-col items-center justify-center text-center border border-gray-700">
                        <h2 class="text-2xl font-bold text-green-400 mb-2">GENEL</h2>
                        <p class="text-gray-400">Tüm birimleri ilgilendiren ortak belgeler.</p>
                    </div>
                </div>

                <!-- HAP BİLGİ KARTI -->
                <div id="pill-info-container" class="max-w-4xl mx-auto w-full px-4 md:px-0 hidden">
                    <div class="pill-card bg-gradient-to-r from-purple-900/40 to-indigo-900/40 backdrop-blur-md rounded-xl p-6 border-2 border-indigo-500/30 shadow-lg relative overflow-hidden group cursor-pointer transition-all hover:scale-[1.01]">
                        <div class="absolute top-0 right-0 p-3 opacity-20 group-hover:opacity-40 transition">
                            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
                        </div>
                        <div class="flex justify-between items-start mb-2 relative z-10">
                            <h3 class="text-xl font-bold text-indigo-300 flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-yellow-400"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                                GÜNLÜK HAP BİLGİ
                            </h3>
                            <button id="refresh-pill-btn" class="p-1.5 rounded-full hover:bg-white/10 text-indigo-300 hover:text-white transition" title="Yeni Bilgi Getir">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>
                            </button>
                        </div>
                        <p id="pill-content" class="text-lg text-gray-200 font-medium mb-3 relative z-10 italic">Yükleniyor...</p>
                        <p class="text-xs text-indigo-400 relative z-10">Belgeyi incelemek için tıklayınız.</p>
                    </div>
                </div>
            </div>

            <!-- Duyurular ve İhaleler Bölümü -->
            <div id="news-section" class="max-w-6xl mx-auto w-full mt-12 mb-8 grid grid-cols-1 md:grid-cols-2 gap-8 text-center">
                <!-- Duyurular -->
                <a href="https://www.tkgm.gov.tr/tum-duyurular" target="_blank" class="block hover:opacity-80 transition">
                    <h2 class="text-2xl font-bold text-white border-b-2 border-orange-500 pb-2 mb-4 inline-block">DUYURULAR</h2>
                </a>
                <!-- İhaleler -->
                <a href="https://www.tkgm.gov.tr/ihaleler" target="_blank" class="block hover:opacity-80 transition">
                    <h2 class="text-2xl font-bold text-white border-b-2 border-blue-500 pb-2 mb-4 inline-block">İHALELER</h2>
                </a>
            </div>

        </main>
    </div>

    <!-- Modals -->
    <div id="selection-modal" class="modal">
        <div id="selection-modal-content" class="modal-content">
            <header id="selection-modal-header" class="modal-header">
                <div class="flex items-center gap-3">
                    <button id="selection-back-btn" class="p-2 rounded-full hover:bg-gray-700 transition hidden text-gray-300"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg></button>
                    <h2 id="selection-modal-title" class="text-2xl font-bold text-white">Seçim yapınız</h2>
                </div>
                <div class="flex items-center gap-3">
                    <button id="sort-btn" class="hidden flex items-center gap-2 px-3 py-1.5 rounded-lg bg-gray-700 hover:bg-gray-600 transition text-xs sm:text-sm text-white" title="Sıralama Değiştir">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 5h10M11 9h10M11 13h10M11 17h10M5 5l3 3-3 3M8 15l-3 3 3 3"/></svg>
                        <span id="sort-label">Yeniden Eskiye</span>
                    </button>
                    <button id="selection-close-btn" class="p-2 rounded-full hover:bg-red-500/20 text-red-400 transition"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
                </div>
            </header>
            <div id="selection-modal-body"></div>
        </div>
    </div>

    <div id="favorites-modal" class="modal">
        <div id="favorites-modal-content" class="modal-content">
            <header class="modal-header">
                <h2 class="text-2xl font-bold text-white">Favoriler</h2>
                <button id="favorites-close-btn" class="p-2 rounded-full hover:bg-red-500/20 text-red-400 transition"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
            </header>
            <div id="favorites-modal-body"></div>
        </div>
    </div>

    <div id="share-modal" class="modal">
        <div id="share-modal-content" class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold text-white">Paylaş</h3>
                <button id="share-close-btn" class="p-2 rounded-full hover:bg-red-500/20 text-red-400 transition"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
            </div>
            <div class="flex justify-center items-center gap-6 text-gray-300">
                <a id="share-facebook" href="#" target="_blank" class="text-center hover:text-white transition">
                    <svg class="w-10 h-10" fill="currentColor" viewBox="0 0 24 24"><path d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v3.385z"></path></svg>
                    <span class="text-xs mt-1">Facebook</span>
                </a>
                <a id="share-twitter" href="#" target="_blank" class="text-center hover:text-white transition">
                    <svg class="w-10 h-10" fill="currentColor" viewBox="0 0 24 24"><path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616v.064c0 2.295 1.616 4.224 3.765 4.665-.69.188-1.432.23-2.184.087.623 1.953 2.434 3.374 4.589 3.415-1.918 1.508-4.333 2.242-6.917 2.033.633 4.393 4.413 7.18 8.86 7.18 10.211 0 15.344-8.284 15.01-15.145.923-.668 1.734-1.515 2.368-2.454z"></path></svg>
                    <span class="text-xs mt-1">Twitter</span>
                </a>
                <a id="share-whatsapp" href="#" target="_blank" class="text-center hover:text-white transition">
                   <svg class="w-10 h-10" fill="currentColor" viewBox="0 0 24 24"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.894 11.892-1.99-.001-3.956-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.886-.001 2.267.655 4.398 1.908 6.161l-1.317 4.816 4.895-1.291z"></path></svg>
                    <span class="text-xs mt-1">WhatsApp</span>
                </a>
            </div>
        </div>
    </div>

    <div id="pdf-modal" class="modal">
        <div id="pdf-modal-content" class="modal-content">
            <header class="modal-header flex flex-wrap items-center justify-between gap-y-2 !p-2">
                <h3 id="pdf-title" class="text-base sm:text-lg font-bold text-white truncate w-full sm:w-auto sm:flex-1 order-1 sm:order-none"></h3>
                <div class="flex items-center gap-2 sm:gap-4 order-2 sm:order-none justify-end">
                    <div class="flex items-center gap-2 text-white">
                        <button id="zoom-out-btn" class="p-2 rounded-full hover:bg-gray-600 transition"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="8" y1="11" x2="14" y2="11"></line></svg></button>
                        <span id="zoom-level" class="text-sm w-12 text-center">100%</span>
                        <button id="zoom-in-btn" class="p-2 rounded-full hover:bg-gray-600 transition"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="11" y1="8" x2="11" y2="14"></line><line x1="8" y1="11" x2="14" y2="11"></line></svg></button>
                    </div>
                     <button id="fullscreen-btn" class="p-2 rounded-full hover:bg-gray-600 transition text-white" title="Tam Ekran">
                        <svg id="enter-fullscreen-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></svg>
                        <svg id="exit-fullscreen-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="hidden"><path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"/></svg>
                    </button>
                     <button id="close-modal-btn" class="p-2 rounded-full hover:bg-red-500/20 text-red-400 hover:text-red-300 transition"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
                </div>
                <div class="flex items-center gap-2 w-full order-3">
                     <input type="text" id="pdf-search-input" placeholder="PDF içinde ara..." class="bg-gray-700 border border-gray-600 rounded-md py-1 px-2 text-sm w-full text-white placeholder:text-gray-400">
                     <button id="pdf-search-prev" class="p-1.5 rounded-md bg-gray-600 hover:bg-gray-500 transition disabled:opacity-50 disabled:cursor-not-allowed text-white flex-shrink-0"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg></button>
                     <span id="pdf-search-results-count" class="text-sm text-gray-400 w-16 text-center flex-shrink-0">0 / 0</span>
                     <button id="pdf-search-next" class="p-1.5 rounded-md bg-gray-600 hover:bg-gray-500 transition disabled:opacity-50 disabled:cursor-not-allowed text-white flex-shrink-0"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg></button>
                </div>
            </header>
            <div id="pdf-render-area">
                 <div id="pdf-loader" class="absolute inset-0 flex items-center justify-center" style="display: none;"><div class="loader"></div></div>
                 <div id="pdf-pages-container"></div>
            </div>
            <footer id="pdf-modal-footer" class="flex justify-center items-center p-2 border-t border-gray-700">
                <button id="prev-page-btn" class="px-4 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 transition text-white">Önceki</button>
                <div id="page-num" class="text-sm font-medium text-white mx-4"></div>
                <button id="next-page-btn" class="px-4 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 transition text-white">Sonraki</button>
            </footer>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast"></div>

    <script type="module">
        const pdfjsLib = window['pdfjs-dist/build/pdf'];
        pdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js`;

        const GITHUB_USERNAME = "gokhangeo", GITHUB_REPO = "tkmevzuat", GITHUB_BRANCH = "main";
        const TOKEN_PART_1 = "ghp_lF2vgNowgiKuR0ZEk", TOKEN_PART_2 = "11eyVvV0nIJfy3dMEjP";
        const githubRawUrl = `https://raw.githubusercontent.com/${GITHUB_USERNAME}/${GITHUB_REPO}/${GITHUB_BRANCH}/`;
        const githubApiUrl = `https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPO}/contents/`;
        let mevzuatData = { tapu: {}, kadastro: {}, genel: {} };
        const FAVORITES_KEY = 'tkgm_mevzuat_favorites';

        // DOM Elements
        const mainLoader = document.getElementById('main-loader-container'), appContainer = document.getElementById('app-container');
        const searchInput = document.getElementById('search-input'), searchResultsContainer = document.getElementById('search-results');
        const clearSearchBtn = document.getElementById('clear-search-btn');
        const voiceSearchBtn = document.getElementById('voice-search-btn');
        const mainCategoriesContainer = document.getElementById('main-categories');
        const favoritesMainBtn = document.getElementById('favorites-main-btn');
        
        const pillInfoContainer = document.getElementById('pill-info-container');
        const pillContent = document.getElementById('pill-content');
        const refreshPillBtn = document.getElementById('refresh-pill-btn');
        const pillCard = document.querySelector('.pill-card');

        const selectionModal = document.getElementById('selection-modal'), selectionModalTitle = document.getElementById('selection-modal-title');
        const selectionModalBody = document.getElementById('selection-modal-body'), selectionBackBtn = document.getElementById('selection-back-btn');
        const selectionCloseBtn = document.getElementById('selection-close-btn');
        const sortBtn = document.getElementById('sort-btn'), sortLabel = document.getElementById('sort-label');

        const favoritesModal = document.getElementById('favorites-modal'), favoritesModalBody = document.getElementById('favorites-modal-body');
        const favoritesCloseBtn = document.getElementById('favorites-close-btn');

        const shareModal = document.getElementById('share-modal');
        const shareCloseBtn = document.getElementById('share-close-btn');

        const pdfModal = document.getElementById('pdf-modal'), pdfTitle = document.getElementById('pdf-title'), pdfLoader = document.getElementById('pdf-loader');
        const pdfRenderArea = document.getElementById('pdf-render-area');
        const pdfPagesContainer = document.getElementById('pdf-pages-container');
        const zoomInBtn = document.getElementById('zoom-in-btn'), zoomOutBtn = document.getElementById('zoom-out-btn'), zoomLevelDisplay = document.getElementById('zoom-level');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const fullscreenBtn = document.getElementById('fullscreen-btn');
        const enterFullscreenIcon = document.getElementById('enter-fullscreen-icon');
        const exitFullscreenIcon = document.getElementById('exit-fullscreen-icon');
        const pdfSearchInput = document.getElementById('pdf-search-input'), pdfSearchPrevBtn = document.getElementById('pdf-search-prev');
        const pdfSearchNextBtn = document.getElementById('pdf-search-next'), pdfSearchResultsCount = document.getElementById('pdf-search-results-count');
        const pdfModalFooter = document.getElementById('pdf-modal-footer'), prevPageBtn = document.getElementById('prev-page-btn');
        const nextPageBtn = document.getElementById('next-page-btn'), pageNumDisplay = document.getElementById('page-num');
        const toast = document.getElementById('toast');
        
        // State
        let currentSection = null, pdfDoc = null, initialScale = 1.0, currentPageNum = 1;
        let searchMatches = [], currentMatchIndex = -1;
        let pdfPageTextContents = new Map();
        let rerenderTimer;
        let pdfTransform = { scale: 1 };
        let initialPinchDistance = null;
        let isPanning = false;
        let lastPanPoint = { x: 0, y: 0 };
        let currentDocToShare = null;
        let pageIntersectionObserver = null;
        let currentDocType = null; // 'genelge' or 'talimat'
        let isSortAscending = false; // default: newest first (descending)
        let currentPillDoc = null; // To store the currently displayed random doc

        // --- 3D Background (Connected Network/Nerve Effect) ---
        const bgCanvas = document.getElementById('dynamic-bg');
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 20;
        
        const renderer = new THREE.WebGLRenderer({ canvas: bgCanvas, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);

        const particleCount = 100;
        const connectionDistance = 3.5; 
        
        // Particles
        const particlesGeometry = new THREE.BufferGeometry();
        const particlePositions = new Float32Array(particleCount * 3);
        const particleVelocities = [];
        
        for(let i=0; i<particleCount; i++) {
            const x = (Math.random() - 0.5) * 30;
            const y = (Math.random() - 0.5) * 30;
            const z = (Math.random() - 0.5) * 30;
            
            particlePositions[i*3] = x;
            particlePositions[i*3+1] = y;
            particlePositions[i*3+2] = z;
            
            particleVelocities.push({
                x: (Math.random() - 0.5) * 0.05,
                y: (Math.random() - 0.5) * 0.05,
                z: (Math.random() - 0.5) * 0.05
            });
        }
        
        particlesGeometry.setAttribute('position', new THREE.BufferAttribute(particlePositions, 3));
        const particlesMaterial = new THREE.PointsMaterial({ 
            color: 0x87CEEB, 
            size: 0.15,
            transparent: true,
            opacity: 0.8
        });
        const particlesMesh = new THREE.Points(particlesGeometry, particlesMaterial);
        scene.add(particlesMesh);

        // Lines
        const linesGeometry = new THREE.BufferGeometry();
        const linesMaterial = new THREE.LineBasicMaterial({ 
            color: 0x87CEEB, 
            transparent: true, 
            opacity: 0.3 
        });
        const linesMesh = new THREE.LineSegments(linesGeometry, linesMaterial);
        scene.add(linesMesh);

        let mouseX = 0, mouseY = 0;
        document.addEventListener('mousemove', (event) => { mouseX = event.clientX; mouseY = event.clientY; });

        const animate = () => {
            requestAnimationFrame(animate);
            
            // Update Particles
            const positions = particlesMesh.geometry.attributes.position.array;
            
            for(let i=0; i<particleCount; i++) {
                // Update position
                positions[i*3] += particleVelocities[i].x;
                positions[i*3+1] += particleVelocities[i].y;
                positions[i*3+2] += particleVelocities[i].z;
                
                // Boundary check (simple box bounce)
                if(Math.abs(positions[i*3]) > 15) particleVelocities[i].x *= -1;
                if(Math.abs(positions[i*3+1]) > 15) particleVelocities[i].y *= -1;
                if(Math.abs(positions[i*3+2]) > 15) particleVelocities[i].z *= -1;
            }
            particlesMesh.geometry.attributes.position.needsUpdate = true;

            // Connect Particles (The "Nerve" effect)
            const linePositions = [];
            const pPos = particlesMesh.geometry.attributes.position.array;
            
            for(let i=0; i<particleCount; i++) {
                for(let j=i+1; j<particleCount; j++) {
                    const dx = pPos[i*3] - pPos[j*3];
                    const dy = pPos[i*3+1] - pPos[j*3+1];
                    const dz = pPos[i*3+2] - pPos[j*3+2];
                    const dist = Math.sqrt(dx*dx + dy*dy + dz*dz);

                    if (dist < connectionDistance) {
                        linePositions.push(
                            pPos[i*3], pPos[i*3+1], pPos[i*3+2],
                            pPos[j*3], pPos[j*3+1], pPos[j*3+2]
                        );
                    }
                }
            }
            
            linesMesh.geometry.setAttribute('position', new THREE.Float32BufferAttribute(linePositions, 3));
            
            // Gentle rotation
            const time = Date.now() * 0.0005;
            scene.rotation.y = time * 0.1;
            scene.rotation.x = mouseY * 0.0001;
            
            renderer.render(scene, camera);
        };
        
        animate();
        
        window.addEventListener('resize', () => {
            renderer.setSize(window.innerWidth, window.innerHeight);
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
        });

        // --- Utility & Core Functions ---
        function getGitHubToken() { return TOKEN_PART_1 + TOKEN_PART_2; }
        function extractYear(title) { const match = title.match(/\b(19|20)\d{2}\b/); return match ? parseInt(match[0], 10) : 0; }
        
        function formatTitle(filename) {
            let title = filename.replace(/\.pdf$/i, '').replace(/_/g, ' ');
            return title.split(' ').map(word => {
                if (word.length > 0) {
                    return word.charAt(0).toLocaleUpperCase('tr-TR') + word.slice(1);
                }
                return word;
            }).join(' ');
        }
        
        async function fetchFilesFromRepo(path) {
            const GITHUB_TOKEN = getGitHubToken();
            try {
                const response = await fetch(`${githubApiUrl}${path}?t=${new Date().getTime()}`, { headers: { 'Authorization': `token ${GITHUB_TOKEN}` } });
                if (response.status === 404) {
                    console.log(`'${path}' yolu bulunamadı, atlanıyor.`);
                    return [];
                }
                if (!response.ok) { throw new Error(`Network response was not ok for ${path}`); }
                const files = await response.json();
                if (!Array.isArray(files)) return [];
                const mappedFiles = files.filter(f => f.type === 'file' && f.name.toLowerCase().endsWith('.pdf')).map(f => ({ title: formatTitle(f.name), path: f.path }));
                // Initial sort: Newest first
                mappedFiles.sort((a, b) => extractYear(b.title) - extractYear(a.title));
                return mappedFiles;
            } catch (error) { 
                console.error(`'${path}' yüklenirken kritik hata:`, error); 
                return [];
            }
        }
        
        async function initializeApp() {
            const [tapuGenelgeler, tapuTalimatlar, kadastroGenelgeler, kadastroTalimatlar, genelGenelgeler, genelTalimatlar] = await Promise.all([
                fetchFilesFromRepo('tapu/genelgeler'), fetchFilesFromRepo('tapu/talimatlar'),
                fetchFilesFromRepo('kadastro/genelgeler'), fetchFilesFromRepo('kadastro/talimatlar'),
                fetchFilesFromRepo('genel/genelgeler'), fetchFilesFromRepo('genel/talimatlar')
            ]);
            mevzuatData = { 
                tapu: { genelge: tapuGenelgeler, talimat: tapuTalimatlar }, 
                kadastro: { genelge: kadastroGenelgeler, talimat: kadastroTalimatlar },
                genel: { genelge: genelGenelgeler, talimat: genelTalimatlar }
            };
            mainLoader.style.display = 'none'; appContainer.style.display = 'flex';
            setupTouchEvents();
            setupShareEventListeners();
            setupVoiceSearch();
            setupDailyPill();
        }

        // --- Hap Bilgi (Daily Pill) Logic ---
        function setupDailyPill() {
            pillInfoContainer.classList.remove('hidden');
            updateDailyPill();
            
            refreshPillBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                updateDailyPill();
            });

            pillCard.addEventListener('click', () => {
                if (currentPillDoc) {
                    openPdfModal(currentPillDoc.path, currentPillDoc.title);
                }
            });
        }

        async function updateDailyPill() {
            const allDocs = [];
            for (const section in mevzuatData) {
                for (const type in mevzuatData[section]) {
                    allDocs.push(...mevzuatData[section][type]);
                }
            }

            if (allDocs.length === 0) {
                pillContent.textContent = "Şu anda görüntülenecek bilgi yok.";
                return;
            }

            pillContent.style.opacity = '0';
            
            // Show loading state
            setTimeout(() => {
                pillContent.textContent = "Mevzuat taranıyor, hap bilgi hazırlanıyor...";
                pillContent.style.opacity = '1';
                pillContent.classList.add('animate-pulse');
            }, 200);

            try {
                // Retry logic if extraction fails (try up to 3 different docs)
                for (let i = 0; i < 3; i++) {
                    const randomIndex = Math.floor(Math.random() * allDocs.length);
                    const doc = allDocs[randomIndex];
                    const summary = await extractSummaryFromPdf(doc.path);
                    
                    if (summary) {
                        currentPillDoc = doc;
                        pillContent.classList.remove('animate-pulse');
                        pillContent.style.opacity = '0';
                        setTimeout(() => {
                            pillContent.innerHTML = `<span class="font-bold text-yellow-400 block mb-1">${doc.title}:</span> ${summary}`;
                            pillContent.style.opacity = '1';
                        }, 200);
                        return;
                    }
                }
                // Fallback if extraction fails after 3 tries
                throw new Error("Özet çıkarılamadı");
            } catch (e) {
                console.warn("Hap bilgi oluşturulamadı, başlık gösteriliyor:", e);
                const randomIndex = Math.floor(Math.random() * allDocs.length);
                currentPillDoc = allDocs[randomIndex];
                pillContent.classList.remove('animate-pulse');
                pillContent.style.opacity = '0';
                setTimeout(() => {
                    pillContent.textContent = `"${currentPillDoc.title}" belgesini incelediniz mi?`;
                    pillContent.style.opacity = '1';
                }, 200);
            }
        }

        async function extractSummaryFromPdf(path) {
            try {
                const url = githubRawUrl + encodeURI(path);
                const loadingTask = pdfjsLib.getDocument(url);
                const pdf = await loadingTask.promise;
                // Check first two pages as content might spill over or start late
                let fullText = "";
                const page1 = await pdf.getPage(1);
                const textContent1 = await page1.getTextContent();
                fullText += textContent1.items.map(item => item.str).join(' ');
                
                if (pdf.numPages > 1) {
                    const page2 = await pdf.getPage(2);
                    const textContent2 = await page2.getTextContent();
                    fullText += " " + textContent2.items.map(item => item.str).join(' ');
                }
                
                // Clean up extra spaces and normalize
                fullText = fullText.replace(/\s+/g, ' ').trim();

                // 1. Priority: Semantic "Summary" Keywords
                // These usually precede the main point of the circular
                const importanceIndicators = [
                    "Bu itibarla", 
                    "Bu çerçevede", 
                    "Buna göre", 
                    "Sonuç olarak",
                    "Netice itibarıyla",
                    "Özetle"
                ];

                for (const indicator of importanceIndicators) {
                    // Find sentence starting with indicator
                    const regex = new RegExp(`(${indicator}[^.?!]*[.?!])`, 'i');
                    const match = fullText.match(regex);
                    if (match && match[1].length > 40) { // Ensure it's not too short
                        return match[1];
                    }
                }

                // 2. Secondary Priority: Imperative/Instruction Verbs
                // Find sentences that end with specific directive verbs
                const instructionRegex = /([^.?!]*(?:gerekmektedir|yapılmalıdır|edilmelidir|zorunludur|arz ederim|rica ederim)[^.?!]*[.?!])/gi;
                const instructions = fullText.match(instructionRegex);
                
                if (instructions && instructions.length > 0) {
                    // Filter out short/junk sentences and pick the longest/most descriptive one
                    const meaningfulInstructions = instructions.filter(s => s.length > 60 && !s.includes("......") && !s.match(/Adres:|Tel:|Faks:/i));
                    if (meaningfulInstructions.length > 0) {
                        // Return the one with maximum length (usually contains the full rule)
                        return meaningfulInstructions.reduce((a, b) => a.length > b.length ? a : b);
                    }
                }

                // 3. Fallback: Clean Body Text Paragraph
                // Aggressively clean header info to find the first real paragraph
                let cleanText = fullText
                    .replace(/T\.C\..*?Genel Müdürlüğü/i, '')
                    .replace(/Sayı\s*:.*?(?:Konu|İlgi)/i, '')
                    .replace(/Konu\s*:.*?(?:İlgi|Sayı)/i, '')
                    .replace(/İlgi\s*:.*?(?:Sayı|Konu|Bakanlık)/i, '')
                    .replace(/Dağıtım\s*:/i, '')
                    .replace(/Bilgi\s*:/i, '');
                
                // Split by punctuation to get sentences
                const sentences = cleanText.split(/(?:\.|\?|\!)\s+/);
                
                // Find the first sentence that looks like valid content
                const goodSentence = sentences.find(s => 
                    s.length > 80 && // Must be substantial length
                    s.length < 500 && // Don't take whole page
                    !s.includes("......") && // Skip placeholders
                    !s.match(/Adres:|Telefon:|Faks:|E-Posta:|Kep:|Mersis:/i) && // Skip footer info
                    !s.match(/Daire Başkanı|Genel Müdür/i) // Skip signatures
                );
                
                if (goodSentence) {
                    return goodSentence + ".";
                }

                // 4. Last Resort: Subject Line
                const konuMatch = fullText.match(/(?:Konu|KONU)\s*[:]\s*(.*?)(?=\s*(?:İlgi|İLGİ|Sayı|SAYI|T\.C\.|Davacı)|$)/i);
                if (konuMatch && konuMatch[1] && konuMatch[1].length > 10) {
                     return "Konu: " + konuMatch[1].trim();
                }

                return null;
            } catch (error) {
                console.error("PDF extract error", error);
                return null;
            }
        }

        // --- Voice Search Logic ---
        function setupVoiceSearch() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                voiceSearchBtn.style.display = 'none';
                return;
            }
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            const recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.lang = 'tr-TR';
            
            voiceSearchBtn.addEventListener('click', () => {
                if (voiceSearchBtn.classList.contains('voice-active')) {
                    recognition.stop();
                } else {
                    recognition.start();
                }
            });
            
            recognition.onstart = () => {
                voiceSearchBtn.classList.add('voice-active');
                showToast("Dinliyorum...");
            };
            
            recognition.onend = () => {
                voiceSearchBtn.classList.remove('voice-active');
            };
            
            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                searchInput.value = transcript;
                searchInput.dispatchEvent(new Event('input'));
                showToast(`Aranan: "${transcript}"`);
            };
            
            recognition.onerror = (event) => {
                console.error("Ses algılama hatası:", event.error);
                showToast("Ses anlaşılamadı.", true);
                voiceSearchBtn.classList.remove('voice-active');
            };
        }

        // --- Favorites Logic ---
        function getFavorites() { return JSON.parse(localStorage.getItem(FAVORITES_KEY)) || []; }
        function saveFavorites(favorites) { localStorage.setItem(FAVORITES_KEY, JSON.stringify(favorites)); }
        function isFavorite(path) { return getFavorites().some(fav => fav.path === path); }
        function toggleFavorite(doc) {
            let favorites = getFavorites();
            if (isFavorite(doc.path)) {
                favorites = favorites.filter(fav => fav.path !== doc.path);
                showToast("Favorilerden kaldırıldı.");
            } else {
                favorites.push(doc);
                showToast("Favorilere eklendi.");
            }
            saveFavorites(favorites);
        }

        // --- Document Actions (Download, Share) ---
        async function downloadDocument(doc) {
            showToast("Belge indiriliyor...");
            try {
                const url = githubRawUrl + encodeURI(doc.path);
                const response = await fetch(url);
                if (!response.ok) throw new Error('Dosya indirilemedi.');
                const blob = await response.blob();
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = doc.title.replace(/[/\\?%*:|"<>]/g, '-') + '.pdf';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(a.href);
            } catch (error) {
                console.error("İndirme hatası:", error);
                showToast("İndirme başarısız oldu.", true);
            }
        }

        function openShareModal(doc) {
            currentDocToShare = doc;
            const docUrl = `${window.location.origin}${window.location.pathname}?doc=${encodeURIComponent(doc.path)}`;
            const text = encodeURIComponent(`TKGM Mevzuat Belgesi: ${doc.title}`);

            document.getElementById('share-facebook').href = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(docUrl)}`;
            document.getElementById('share-twitter').href = `https://twitter.com/intent/tweet?url=${encodeURIComponent(docUrl)}&text=${text}`;
            document.getElementById('share-whatsapp').href = `https://api.whatsapp.com/send?text=${text}%20${encodeURIComponent(docUrl)}`;
            
            shareModal.classList.add('active');
        }

        function closeShareModal() {
            shareModal.classList.remove('active');
        }

        function setupShareEventListeners() {
            shareCloseBtn.addEventListener('click', closeShareModal);
        }

        // --- UI Rendering ---
        function createDocumentListItemHTML(doc) {
            const isFav = isFavorite(doc.path);
            return `
                <div class="document-item group p-3 bg-gray-800/80 rounded-lg hover:bg-gray-700/80 transition flex items-center justify-between text-gray-300 border border-gray-700 hover:border-gray-600">
                    <div class="document-title-container flex items-center gap-3 overflow-hidden flex-grow cursor-pointer" data-path="${doc.path}" data-title="${doc.title}">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-500 flex-shrink-0"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>
                        <span class="font-medium text-sm truncate">${doc.title}</span>
                    </div>
                    <div class="flex items-center gap-1 flex-shrink-0 ml-2">
                        <button class="favorite-btn p-2 rounded-full hover:bg-gray-600/50 transition ${isFav ? 'favorited' : ''}" title="Favoriye Ekle" data-path="${doc.path}" data-title="${doc.title}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
                        </button>
                        <button class="download-btn p-2 rounded-full hover:bg-gray-600/50 transition" title="İndir" data-path="${doc.path}" data-title="${doc.title}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                        </button>
                        <button class="share-btn p-2 rounded-full hover:bg-gray-600/50 transition" title="Paylaş" data-path="${doc.path}" data-title="${doc.title}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line></svg>
                        </button>
                    </div>
                </div>`;
        }

        function showToast(message, isError = false) {
            toast.textContent = message;
            toast.className = `show ${isError ? 'bg-red-600' : 'bg-indigo-600'}`;
            setTimeout(() => {
                toast.className = toast.className.replace("show", "");
            }, 3000);
        }

        // --- Modal Logic ---
        function openSelectionModal(section) {
            currentSection = section;
            selectionModal.classList.add('active');
            showCategoryChoice();
        }
        function closeSelectionModal() { selectionModal.classList.remove('active'); }
        
        function showCategoryChoice() {
            selectionModalTitle.textContent = `${currentSection.charAt(0).toUpperCase() + currentSection.slice(1)} Mevzuatları`;
            selectionBackBtn.classList.add('hidden');
            sortBtn.classList.add('hidden'); // Hide sort on main category choice
            selectionModalBody.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div data-type="genelge" class="group p-6 bg-gray-800/50 backdrop-blur-sm rounded-lg text-center cursor-pointer hover:shadow-xl hover:-translate-y-1 transition-all duration-300 border-2 border-transparent hover:border-yellow-500">
                        <h3 class="text-xl font-bold text-white">Genelgeler</h3>
                    </div>
                    <div data-type="talimat" class="group p-6 bg-gray-800/50 backdrop-blur-sm rounded-lg text-center cursor-pointer hover:shadow-xl hover:-translate-y-1 transition-all duration-300 border-2 border-transparent hover:border-blue-500">
                        <h3 class="text-xl font-bold text-white">Talimatlar</h3>
                    </div>
                </div>`;
            selectionModalBody.querySelectorAll('[data-type]').forEach(card => {
                card.addEventListener('click', (e) => showDocumentList(e.currentTarget.dataset.type));
            });
        }
        
        function toggleSort() {
            isSortAscending = !isSortAscending;
            sortLabel.textContent = isSortAscending ? 'Eskiden Yeniye' : 'Yeniden Eskiye';
            if (currentDocType) {
                showDocumentList(currentDocType);
            }
        }

        function showDocumentList(type) {
            currentDocType = type;
            selectionModalTitle.textContent = type.charAt(0).toUpperCase() + type.slice(1);
            selectionBackBtn.classList.remove('hidden');
            sortBtn.classList.remove('hidden'); // Show sort button
            
            let documents = [...mevzuatData[currentSection][type]];
            
            // Sort logic
            documents.sort((a, b) => {
                const yearA = extractYear(a.title);
                const yearB = extractYear(b.title);
                return isSortAscending ? yearA - yearB : yearB - yearA;
            });

            if (!documents || documents.length === 0) {
                selectionModalBody.innerHTML = `<p class="text-center text-gray-400">Bu kategoride belge bulunmuyor.</p>`;
                return;
            }
            selectionModalBody.innerHTML = `<div class="space-y-3">${documents.map(createDocumentListItemHTML).join('')}</div>`;
            addDocumentListEventListeners(selectionModalBody);
        }

        function openFavoritesModal() {
            favoritesModal.classList.add('active');
            renderFavoritesList();
        }
        function closeFavoritesModal() { favoritesModal.classList.remove('active'); }
        function renderFavoritesList() {
            const favorites = getFavorites();
            if (favorites.length === 0) {
                favoritesModalBody.innerHTML = `<p class="text-center text-gray-400">Henüz favori belgeniz yok.</p>`;
                return;
            }
            favoritesModalBody.innerHTML = `<div class="space-y-3">${favorites.map(createDocumentListItemHTML).join('')}</div>`;
            addDocumentListEventListeners(favoritesModalBody, true);
        }

        function addDocumentListEventListeners(container, isFavoritesList = false) {
            container.querySelectorAll('.document-title-container').forEach(item => {
                item.addEventListener('click', e => {
                    const { path, title } = e.currentTarget.dataset;
                    // Important: We do NOT close the selection modal here anymore.
                    // closeSelectionModal(); 
                    // closeFavoritesModal();
                    openPdfModal(path, title);
                });
            });
            container.querySelectorAll('.favorite-btn').forEach(btn => {
                btn.addEventListener('click', e => {
                    e.stopPropagation();
                    const { path, title } = e.currentTarget.dataset;
                    toggleFavorite({ path, title });
                    const icon = e.currentTarget;
                    icon.classList.toggle('favorited');
                    if (isFavoritesList) {
                        renderFavoritesList();
                    }
                });
            });
            container.querySelectorAll('.download-btn').forEach(btn => {
                btn.addEventListener('click', e => {
                    e.stopPropagation();
                    const { path, title } = e.currentTarget.dataset;
                    downloadDocument({ path, title });
                });
            });
            container.querySelectorAll('.share-btn').forEach(btn => {
                btn.addEventListener('click', e => {
                    e.stopPropagation();
                    const { path, title } = e.currentTarget.dataset;
                    openShareModal({ path, title });
                });
            });
        }
        
        // --- PDF Viewer Logic ---
        async function openPdfModal(path, title) {
            pdfModal.classList.add('active'); 
            pdfTitle.textContent = title; 
            pdfLoader.style.display = 'flex';
            pdfPagesContainer.innerHTML = '';
            resetSearch();
            pdfModalFooter.style.display = 'flex';
            try {
                const url = githubRawUrl + encodeURI(path);
                pdfDoc = await pdfjsLib.getDocument(url).promise;
                pdfPageTextContents.clear();
                currentPageNum = 1;
                await renderSinglePage(currentPageNum);
            } catch (error) { 
                console.error('PDF yüklenirken hata:', error); 
                showToast("PDF yüklenemedi.", true);
                closePdfModal(); 
            } finally {
                pdfLoader.style.display = 'none';
            }
        }
        function closePdfModal() { 
            pdfModal.classList.remove('active', 'fullscreen-active'); 
            enterFullscreenIcon.classList.remove('hidden');
            exitFullscreenIcon.classList.add('hidden');
            if (pageIntersectionObserver) {
                pageIntersectionObserver.disconnect();
                pageIntersectionObserver = null;
            }
            pdfDoc = null; 
        }
        
        async function renderSinglePage(num) {
            if (pageIntersectionObserver) {
                pageIntersectionObserver.disconnect();
                pageIntersectionObserver = null;
            }
            pdfLoader.style.display = 'flex';
            pdfPagesContainer.innerHTML = ''; // Clear for single page view
            
            currentPageNum = num;
            await reRenderCurrentPage(true); // Recalculate scale for single page view
            
            pageNumDisplay.textContent = `${currentPageNum} / ${pdfDoc.numPages}`;
            prevPageBtn.disabled = currentPageNum <= 1;
            nextPageBtn.disabled = currentPageNum >= pdfDoc.numPages;
            pdfLoader.style.display = 'none';
        }

        async function renderAllPages(recalculateBaseScale = false) {
            if (!pdfDoc) return;
            pdfLoader.style.display = 'flex';
            pdfPagesContainer.innerHTML = '';
            if (pageIntersectionObserver) pageIntersectionObserver.disconnect();

            if (recalculateBaseScale) {
                const pageForViewport = await pdfDoc.getPage(1);
                const viewport = pageForViewport.getViewport({ scale: 1.0 });
                const containerWidth = pdfRenderArea.clientWidth - 32;
                initialScale = containerWidth / viewport.width;
                pdfTransform.scale = initialScale;
                updatePdfUI();
            }

            const renderPromises = [];
            for (let pageNum = 1; pageNum <= pdfDoc.numPages; pageNum++) {
                const pageContainer = document.createElement('div');
                pageContainer.className = 'page-container';
                pageContainer.dataset.pageNum = pageNum;
                pdfPagesContainer.appendChild(pageContainer);

                const renderPromise = pdfDoc.getPage(pageNum).then(page => {
                    return renderPageContent(page, pageContainer);
                });
                renderPromises.push(renderPromise);
            }
            await Promise.all(renderPromises);
            pdfLoader.style.display = 'none';
            setupIntersectionObserver();
            // Scroll to the current page
            const targetPage = pdfPagesContainer.querySelector(`.page-container[data-page-num="${currentPageNum}"]`);
            if (targetPage) {
                targetPage.scrollIntoView({ behavior: 'auto', block: 'start' });
            }
        }

        function setupIntersectionObserver() {
            if (pageIntersectionObserver) pageIntersectionObserver.disconnect();

            const options = {
                root: pdfRenderArea,
                rootMargin: '0px',
                threshold: 0.25,
            };

            pageIntersectionObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const visiblePageNum = parseInt(entry.target.dataset.pageNum, 10);
                        currentPageNum = visiblePageNum;
                    }
                });
            }, options);

            pdfPagesContainer.querySelectorAll('.page-container').forEach(p => pageIntersectionObserver.observe(p));
        }

        async function renderPageContent(page, container) {
            const viewport = page.getViewport({ scale: pdfTransform.scale });
            const outputScale = window.devicePixelRatio || 1;
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = Math.floor(viewport.width * outputScale);
            canvas.height = Math.floor(viewport.height * outputScale);
            canvas.style.width = `${Math.floor(viewport.width)}px`;
            canvas.style.height = `${Math.floor(viewport.height)}px`;
            container.innerHTML = ''; // Clear previous canvas if any
            container.appendChild(canvas);
            container.style.width = canvas.style.width;
            container.style.height = canvas.style.height;
            const renderContext = {
                canvasContext: context,
                viewport: viewport,
                transform: outputScale !== 1 ? [outputScale, 0, 0, outputScale, 0, 0] : null,
            };
            await page.render(renderContext).promise;
            const textLayerDiv = document.createElement('div');
            textLayerDiv.className = 'text-layer';
            container.appendChild(textLayerDiv);
            textLayerDiv.style.width = canvas.style.width;
            textLayerDiv.style.height = canvas.style.height;
            textLayerDiv.style.setProperty('--scale-factor', viewport.scale);
            if (!pdfPageTextContents.has(page.pageNumber)) {
                const textContent = await page.getTextContent();
                pdfPageTextContents.set(page.pageNumber, textContent);
            }
            const textContent = pdfPageTextContents.get(page.pageNumber);
            await pdfjsLib.renderTextLayer({ textContentSource: textContent, container: textLayerDiv, viewport: viewport }).promise;
            highlightSearchOnPage(page.pageNumber);
            updatePdfUI();
        }
        
        async function reRenderCurrentPage(recalculateScale = false) {
            if (!pdfDoc) return;
            pdfLoader.style.display = 'flex';

            if (recalculateScale) {
                const pageForViewport = await pdfDoc.getPage(currentPageNum);
                const viewport = pageForViewport.getViewport({ scale: 1.0 });
                const containerWidth = pdfRenderArea.clientWidth - 32;
                initialScale = containerWidth / viewport.width;
                pdfTransform.scale = initialScale;
                updatePdfUI();
            }

            const page = await pdfDoc.getPage(currentPageNum);
            let container = pdfPagesContainer.querySelector('.page-container');
            if (!container) {
                container = document.createElement('div');
                container.className = 'page-container';
                container.dataset.pageNum = currentPageNum;
                pdfPagesContainer.appendChild(container);
            }
            await renderPageContent(page, container);
            pdfLoader.style.display = 'none';
        }

        function updatePdfUI() { zoomLevelDisplay.textContent = `${Math.round((pdfTransform.scale / initialScale) * 100)}%`; }
        
        function onZoomIn() { 
            pdfTransform.scale = Math.min(pdfTransform.scale * 1.2, 8 * initialScale); 
            updatePdfUI(); 
            if (pdfModal.classList.contains('fullscreen-active')) {
                renderAllPages(false);
            } else {
                reRenderCurrentPage();
            }
        }
        
        function onZoomOut() { 
            pdfTransform.scale = Math.max(pdfTransform.scale / 1.2, 0.25 * initialScale); 
            updatePdfUI(); 
            if (pdfModal.classList.contains('fullscreen-active')) {
                renderAllPages(false);
            } else {
                reRenderCurrentPage();
            }
        }
        
        function onPrevPage() { if (currentPageNum > 1) { renderSinglePage(currentPageNum - 1); } }
        function onNextPage() { if (currentPageNum < pdfDoc.numPages) { renderSinglePage(currentPageNum + 1); } }
        
        function toggleFullscreen() {
            pdfModal.classList.toggle('fullscreen-active');
            const isFullscreen = pdfModal.classList.contains('fullscreen-active');

            if (isFullscreen) {
                enterFullscreenIcon.classList.add('hidden');
                exitFullscreenIcon.classList.remove('hidden');
                renderAllPages(true);
            } else {
                enterFullscreenIcon.classList.remove('hidden');
                exitFullscreenIcon.classList.add('hidden');
                renderSinglePage(currentPageNum); 
            }
        }

        // --- Touch Logic ---
        function setupTouchEvents() {
            pdfRenderArea.addEventListener('touchstart', handleTouchStart, { passive: false });
            pdfRenderArea.addEventListener('touchmove', handleTouchMove, { passive: false });
            pdfRenderArea.addEventListener('touchend', handleTouchEnd);
        }
        function getDistance(touches) { return Math.hypot(touches[0].clientX - touches[1].clientX, touches[0].clientY - touches[1].clientY); }
        function handleTouchStart(e) {
            if (e.touches.length === 2) { e.preventDefault(); isPanning = false; initialPinchDistance = getDistance(e.touches); } 
            else if (e.touches.length === 1) { isPanning = true; lastPanPoint = { x: e.touches[0].clientX, y: e.touches[0].clientY }; }
        }
        function handleTouchMove(e) {
            if (e.touches.length === 2 && initialPinchDistance) {
                e.preventDefault();
                const newDist = getDistance(e.touches);
                const newScale = pdfTransform.scale * (newDist / initialPinchDistance);
                pdfTransform.scale = Math.max(0.25 * initialScale, Math.min(newScale, 8 * initialScale));
                updatePdfUI();
                if (pdfModal.classList.contains('fullscreen-active')) {
                    renderAllPages(false);
                } else {
                    reRenderCurrentPage();
                }
                initialPinchDistance = newDist;
            } else if (e.touches.length === 1 && isPanning) {
                e.preventDefault();
                const dx = e.touches[0].clientX - lastPanPoint.x;
                const dy = e.touches[0].clientY - lastPanPoint.y;
                pdfRenderArea.scrollTop -= dy;
                pdfRenderArea.scrollLeft -= dx;
                lastPanPoint = { x: e.touches[0].clientX, y: e.touches[0].clientY };
            }
        }
        function handleTouchEnd(e) {
            if (e.touches.length < 2) initialPinchDistance = null;
            if (e.touches.length < 1) isPanning = false;
        }

        // --- Search Logic ---
        function resetSearch() {
            searchInput.value = '';
            clearSearchBtn.classList.add('hidden');
            searchResultsContainer.innerHTML = '';
            mainCategoriesContainer.style.display = 'grid';
        }
        function updateSearchUI() {
            pdfSearchResultsCount.textContent = searchMatches.length > 0 ? `${currentMatchIndex + 1} / ${searchMatches.length}` : "0 / 0";
            pdfSearchPrevBtn.disabled = currentMatchIndex <= 0;
            pdfSearchNextBtn.disabled = currentMatchIndex >= searchMatches.length - 1;
        }
        
        function highlightSearchOnPage(pageNum) {
            const pageContainer = pdfPagesContainer.querySelector(`.page-container[data-page-num="${pageNum}"]`);
            if (!pageContainer) return;
            const textLayerDiv = pageContainer.querySelector('.text-layer');
            if (!textLayerDiv) return;

            textLayerDiv.querySelectorAll('mark').forEach(m => {
                const parent = m.parentNode;
                parent.replaceChild(document.createTextNode(m.textContent), m);
                parent.normalize();
            });

            const query = pdfSearchInput.value;
            if (query.length < 2) return;
            
            const regex = new RegExp(`(${query.replace(/[-/\\^$*+?.()|[\]{}]/g, '\\$&')})`, 'giu');
            
            textLayerDiv.querySelectorAll("span").forEach(span => {
                if (regex.test(span.textContent)) {
                    span.innerHTML = span.textContent.replace(regex, `<mark class="highlight">$1</mark>`);
                }
            });

            const currentMatchData = searchMatches[currentMatchIndex];
            if (currentMatchData && currentMatchData.pageNum === pageNum) {
                const allMarksOnPage = Array.from(textLayerDiv.querySelectorAll('mark.highlight'));
                const markToHighlight = allMarksOnPage[currentMatchData.matchIndexOnPage];
                if (markToHighlight) {
                     markToHighlight.classList.add('current-highlight');
                     markToHighlight.classList.remove('highlight');
                }
            }
        }

        async function startSearch() {
            const query = pdfSearchInput.value;
            if (query.length < 2 || !pdfDoc) { resetSearch(); return; }
            pdfLoader.style.display = 'flex';
            searchMatches = [];
            
            const regex = new RegExp(query.replace(/[-/\\^$*+?.()|[\]{}]/g, '\\$&'), 'giu');

            for (let i = 1; i <= pdfDoc.numPages; i++) {
                if (!pdfPageTextContents.has(i)) {
                    const page = await pdfDoc.getPage(i);
                    const textContent = await page.getTextContent();
                    pdfPageTextContents.set(i, textContent);
                }
                const textContent = pdfPageTextContents.get(i);
                
                let pageText = textContent.items.map(item => item.str).join('');
                let match;
                let matchIndexOnPage = 0;
                while ((match = regex.exec(pageText)) !== null) {
                    searchMatches.push({ pageNum: i, matchIndexOnPage: matchIndexOnPage++ });
                }
            }
            pdfLoader.style.display = 'none';
            if (searchMatches.length > 0) {
                currentMatchIndex = 0;
                goToMatch(currentMatchIndex);
            } else {
                showToast("Sonuç bulunamadı.");
            }
            updateSearchUI();
        }

        async function goToMatch(index) {
            if (index < 0 || index >= searchMatches.length) return;
            currentMatchIndex = index;
            const { pageNum } = searchMatches[index];
            
            if (pdfModal.classList.contains('fullscreen-active')) {
                const targetPage = pdfPagesContainer.querySelector(`.page-container[data-page-num="${pageNum}"]`);
                if (targetPage) {
                    targetPage.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    highlightAndScrollToMatch();
                }
            } else {
                if (currentPageNum !== pageNum) {
                    await renderSinglePage(pageNum);
                }
                highlightAndScrollToMatch();
            }
            updateSearchUI();
        }

        function highlightAndScrollToMatch() {
            const container = pdfPagesContainer.querySelector(`.page-container[data-page-num="${currentPageNum}"]`);
            if(!container) return;

            highlightSearchOnPage(currentPageNum);
            
            const allMarks = Array.from(container.querySelectorAll('mark.current-highlight'));
            if (allMarks.length > 0) {
                const currentMark = allMarks[0];
                const markRect = currentMark.getBoundingClientRect();
                const containerRect = pdfRenderArea.getBoundingClientRect();
                
                pdfRenderArea.scrollTo({
                    top: pdfRenderArea.scrollTop + (markRect.top - containerRect.top) - (containerRect.height / 2) + (markRect.height / 2),
                    left: pdfRenderArea.scrollLeft + (markRect.left - containerRect.left) - (containerRect.width / 2) + (markRect.width / 2),
                    behavior: 'smooth'
                });
            }
        }
        
        function displayGlobalSearchResults(results) {
            if (results.length === 0) {
                searchResultsContainer.innerHTML = `<p class="text-center text-gray-400">Aramanızla eşleşen sonuç bulunamadı.</p>`;
                return;
            }
            searchResultsContainer.innerHTML = `<div class="space-y-3">${results.map(doc => createDocumentListItemHTML({ ...doc })).join('')}</div>`;
            addDocumentListEventListeners(searchResultsContainer);
        }

        searchInput.addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase().trim();
            
            if(query.length > 0) {
                clearSearchBtn.classList.remove('hidden');
            } else {
                clearSearchBtn.classList.add('hidden');
            }

            if (query.length < 2) {
                searchResultsContainer.innerHTML = '';
                mainCategoriesContainer.style.display = 'grid';
                return;
            }

            mainCategoriesContainer.style.display = 'none';
            const results = [];
            for (const section in mevzuatData) {
                for (const type in mevzuatData[section]) {
                    mevzuatData[section][type].forEach(doc => {
                        if (doc.title.toLowerCase().includes(query)) {
                            results.push({ ...doc, section, type });
                        }
                    });
                }
            }
            displayGlobalSearchResults(results);
        });
        
        // --- Event Listeners ---
        clearSearchBtn.addEventListener('click', resetSearch);
        favoritesMainBtn.addEventListener('click', openFavoritesModal);
        favoritesCloseBtn.addEventListener('click', closeFavoritesModal);
        pdfSearchInput.addEventListener('keydown', e => { if (e.key === 'Enter') startSearch(); });
        pdfSearchPrevBtn.addEventListener('click', () => goToMatch(currentMatchIndex - 1));
        pdfSearchNextBtn.addEventListener('click', () => goToMatch(currentMatchIndex + 1));
        mainCategoriesContainer.querySelectorAll('[data-section]').forEach(card => card.addEventListener('click', (e) => openSelectionModal(e.currentTarget.dataset.section)));
        selectionCloseBtn.addEventListener('click', closeSelectionModal);
        selectionBackBtn.addEventListener('click', showCategoryChoice);
        sortBtn.addEventListener('click', toggleSort);
        closeModalBtn.addEventListener('click', closePdfModal);
        zoomInBtn.addEventListener('click', onZoomIn);
        zoomOutBtn.addEventListener('click', onZoomOut);
        fullscreenBtn.addEventListener('click', toggleFullscreen);
        prevPageBtn.addEventListener('click', onPrevPage);
        nextPageBtn.addEventListener('click', onNextPage);
        window.addEventListener('keydown', e => { 
            if (e.key === 'Escape') { 
                if (pdfModal.classList.contains('fullscreen-active')) {
                    toggleFullscreen();
                } else {
                    closePdfModal(); 
                    closeSelectionModal(); 
                    closeFavoritesModal(); 
                    closeShareModal(); 
                }
            } 
        });

        initializeApp();
    </script>
</body>
</html>
